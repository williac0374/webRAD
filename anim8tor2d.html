<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basic Template</title>
<style>
body{
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background-color: black;
  
}
canvas {
  // border: 2px solid #000;
  background-color: white;
}
</style>
</head>

<body>
<canvas id="canvas"></canvas>

<script>

canvas.width=500
canvas.height=500
canMake=false
master_rot=0

// THIS IS BASE OBJECT I BASED ALL OTHERS OFF OF.
gizmo = function(id, x, y, w, h, ox, oy, rot, spr) {
  this.id = id;
  this.x = x;
  this.y = y;
  this.w = w;
  this.h = h;
  this.ox = ox;
  this.oy = oy;
  this.rot = rot;
  this.spr = spr;
  this.sel = false;
  
};
parts = [];
pnum=0
rotMod = 5
function start(){
  
}

function loop(){
  input()
  
}

function draw(){
  if(master_rot!=0){
    var cw = canvas.width/2
    var ch = canvas.height/2
    for(let i = 0; i < parts.length; i ++){
      let dis = point_distance(parts[i].x+parts[i].ox,parts[i].y+parts[i].oy,cw,ch)
      let dir = point_direction(cw,ch,parts[i].x+parts[i].ox,parts[i].y+parts[i].oy)
      parts[i].x = cw+lengthdir_x(dis, dir+master_rot) - parts[i].ox
      parts[i].y = ch+lengthdir_y(dis, dir+master_rot) - parts[i].oy
      parts[i].rot -= master_rot
    }
  }
  
  master_rot=0
  for(let i = 0; i < parts.length; i ++){
    draw_image(parts[i].spr,parts[i].x,parts[i].y,parts[i].w,parts[i].h,parts[i].rot,parts[i].ox,parts[i].oy);
    if(parts[i].sel==true){
      draw_set_color(255,0,0)
      draw_set_linewidth(6)
      draw_set_linedash([10,3])
      draw_rectangle(parts[i].x,parts[i].y,parts[i].w,parts[i].h,true,parts[i].rot,parts[i].ox,parts[i].oy)
      draw_set_color(0,255,255)
      draw_circle(parts[i].x+parts[i].ox,parts[i].y+parts[i].oy, 8, false)
    }
  }
  draw_set_color(0,0,0)
  draw_circle(canvas.width/2, canvas.height/2,  8, false) // center of canvas
  //ctx.restore()
}
///////////////////////////////////////////////////////////////////////
function input(){
  var mx = mouse_x;
  var my = mouse_y;
  var offx = 0;
  var offy = 0;
  if(keyboard_check_pressed(vk_up)){
    pnum++
  if(pnum>=parts.length){pnum=0}
  }
  if(keyboard_check_pressed(vk_down)){
    pnum--
  if(pnum<0){pnum=parts.length-1}
  }
  for(let i = parts.length; i>0; i--){
    //pnum
    parts[i-1].sel=false
    parts[pnum].sel=true
    if (parts[i-1].sel==true){
      if(keyboard_check(vk_shift)){
        master_rot+=wheelDir *rotMod//rotates the whole canvas!!
      }else{
        parts[i-1].rot+=wheelDir//rotates on ox,oy
      }
      if(keyboard_check(vk_space)){
      if(keyboard_check_pressed(vk_a)){parts[i-1].ox -= 5}
      if(keyboard_check_pressed(vk_d)){parts[i-1].ox += 5}
      if(keyboard_check_pressed(vk_w)){parts[i-1].oy -= 5}
      if(keyboard_check_pressed(vk_s)){parts[i-1].oy += 5}
        console.log('move origin')
      }else{
      if(keyboard_check(vk_a)){parts[i-1].x -= 5}
      if(keyboard_check(vk_d)){parts[i-1].x += 5}
      if(keyboard_check(vk_w)){parts[i-1].y -= 5}
      if(keyboard_check(vk_s)){parts[i-1].y += 5}
        console.log('move coordinates')
      }
    }
  }
  for(let i = parts.length; i>0; i--){
    var mx = mouse_x;
    var my = mouse_y;
    
  }
  if(mouse_check_pressed()&&keyboard_check(vk_ctrl)){
    key_down[vk_ctrl] = false; // because idk grr
    create_part()
  }
if(keyboard_check_pressed(vk_escape)){window.close()}
  wheelDir=0
}
function create_part(){
  var fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.accept = 'image/*';
  fileInput.addEventListener('change', function(event) {
    var file = event.target.files[0];
    if (file) {
      var reader = new FileReader();
      reader.onload = function(readerEvent) {
        // Set the base64 value to the text box
        // textBox.value = readerEvent.target.result;
        var fileData =  readerEvent.target.result
        //gizmo = function(x, y, w, h, ox, oy, spr) {
          var sprite = draw_set_image(fileData)
          setTimeout(function(){
            let id = file.name.split('.')[0]
            let w = sprite.naturalWidth
            let h = sprite.naturalHeight
            let ox = w/2
            let oy = h/2
            let temp = new gizmo(id, mouse_x, mouse_y, w, h, ox, oy, 0, sprite)
            parts.push(temp)
          },1)
          //alert(sprite.naturalWidth)
          
        };
        reader.readAsDataURL(file);
      }
    });
    fileInput.click();
  }
  ////////////////////////////////////////////////////////////////////////
  </script>
  <script type='text/javascript' src='engine.js'></script>
  
  </body>
  </html>
