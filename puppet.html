<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>joints</title>
<style>
body{
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background-color: black;
  
}
canvas {
  // border: 2px solid #000;
  background-color: white;
}
</style>
</head>

<body>
<canvas id="canvas"></canvas>

<script>
window.onerror = function(message, source, lineno, colno, error) {let code = localStorage.getItem("codeIDE");let getScriptLine = code => code.split("<script>")[0].split("\n").length;let ln = (getScriptLine(code)-1) + lineno;msg = message+" , line :"+ ln+" , column: " +colno+ " , " +error;let errorCursor = {"line":ln,"ch":colno,"sticky":null};localStorage.setItem("errorCursorIDE",JSON.stringify(errorCursor));alert(msg);window.close();}

canvas.width=600;
canvas.height=500;

function start(){
  edit=false
A={x:140,y:140,ox:10,oy:37.5,w:200,h:75,rot:20,rRot:0,parent:null}
B={x:308,y:197,ox:10,oy:37.5,w:150,h:75,rot:0,rRot:0,parent:A,pDis:null,pDir:null}
C={x:437,y:193,ox:10,oy:37.5,w:200,h:75,rot:90,rRot:0,parent:B,pDis:null,pDir:null}
  set_relative_coords(B);
  set_relative_coords(C);
}

function loop(){
  document.title=floor(B.x)+' , '+floor(B.y)
  input()
}
function parent(obj){
  if(obj.pDis && obj.pDir){
    obj.x = obj.parent.x+lengthdir_x(obj.pDis, obj.pDir-obj.parent.rot);
    obj.y = obj.parent.y+lengthdir_y(obj.pDis, obj.pDir-obj.parent.rot);
    obj.rot = obj.parent.rot-obj.rRot
    
  }
  
}
function set_relative_coords(obj){
  obj.pDis = Math.round(point_distance(obj.parent.x,obj.parent.y,obj.x,obj.y))
  obj.pDir = Math.round(point_direction(obj.parent.x,obj.parent.y,obj.x,obj.y)+obj.parent.rot)
  obj.rRot =  obj.parent.rot - obj.rot
}
function draw(){
  //draw_shape(x,y,ox,oy,w,h,rot,lCr,lCg,lCb,bCr,bCg,bCb)
  draw_shape(A,255,128,0,33,33,33)
  draw_shape(B,0,255,0,33,33,33)
  draw_shape(C,0,0,128,33,33,33)
  draw_set_color(0,0,0)
  draw_text(0,canvas.height-60, mouse_x+' , '+mouse_y, 60)
}

function input(){
  if(keyboard_check_released(vk_f)){
    set_relative_coords(B);
    set_relative_coords(C);
  }
  if(keyboard_check(vk_a)){
    A.rot += wheelDir*6;
    parent(B);
    parent(C);
    
  }
  if(keyboard_check(vk_b)){
    B.rot += wheelDir*6;
    parent(C);
    set_relative_coords(B);
    set_relative_coords(C);
  }
  if(keyboard_check(vk_c)){
    C.rot += wheelDir*6;
    set_relative_coords(C);
  }
  if(keyboard_check_pressed(vk_e)){
    edit=true;
  }
  if(keyboard_check_released(vk_e)){
    edit=false;
    set_relative_coords(B);
    set_relative_coords(C);
    
  }
  wheelDir=0
}


function draw_shape(obj,lCr,lCg,lCb,bCr,bCg,bCb){
  draw_set_color(lCr,lCg,lCb)
  draw_rectangle(obj.x-obj.ox, obj.y-obj.oy, obj.w, obj.h,false,obj.rot,obj.ox,obj.oy)
  draw_set_color(bCr,bCg,bCb)
  draw_set_linewidth(8)
  draw_rectangle(obj.x-obj.ox, obj.y-obj.oy, obj.w, obj.h,true,obj.rot,obj.ox,obj.oy)
  draw_set_color(255,0,0)
  draw_circle(obj.x, obj.y, 8, false)
}

</script>
<script type='text/javascript' src='engine.js'></script>

</body>
</html>
