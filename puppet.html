<!--         TO DO            -->
<!-- ADD CAPS LOCK INDICATOR TO CMIRRORPLUS.HTML -->
<!-- FINISH GUI FOR PUPPET EDITOR  -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>joints</title>
<style>
body{
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background-color: black;
  
}
canvas {
  // border: 2px solid #000;
  background-color: white;
}
</style>
</head>

<body>
<canvas id="canvas"></canvas>

<script>
window.onerror = function(message, source, lineno, colno, error) {let code = localStorage.getItem("codeIDE");let getScriptLine = code => code.split("<script>")[0].split("\n").length;let ln = (getScriptLine(code)-1) + lineno;msg = message+" , line :"+ ln+" , column: " +colno+ " , " +error;let errorCursor = {"line":ln,"ch":colno,"sticky":null};localStorage.setItem("errorCursorIDE",JSON.stringify(errorCursor));alert(msg);window.close();}

canvas.width=900;
canvas.height=500;

function start(){
  selected = null
  
  sprite_body= draw_set_image('torso.png');
  sprite_head = draw_set_image('face.png');
  sprite_leg = draw_set_image('leg.png');
  sprite_boot = draw_set_image('boot.png');
  sprite_left_hand = draw_set_image('lhand.png');
  sprite_right_hand = draw_set_image('rhand.png');
BODY = {x:140,y:140,ox:48,oy:48,w:96,h:96,rot:0,rRot:0,parent:null}
HEAD = {x:140,y:92,ox:32,oy:64,w:64,h:64,rot:0,rRot:0,parent:BODY}
LEFTTHIGH = {x:160,y:180,ox:32,oy:0,w:64,h:64,rot:0,rRot:0,parent:BODY}
RIGHTTHIGH = {x:120,y:180,ox:32,oy:0,w:64,h:64,rot:0,rRot:0,parent:BODY}
LEFTCALF = {x:160,y:236,ox:32,oy:0,w:64,h:64,rot:0,rRot:0,parent:LEFTTHIGH}
RIGHTCALF = {x:120,y:236,ox:32,oy:0,w:64,h:64,rot:0,rRot:0,parent:RIGHTTHIGH}
LEFTBOOT = {x:160,y:295,ox:32,oy:20,w:64,h:64,rot:0,rRot:0,parent:LEFTCALF}
RIGHTBOOT = {x:120,y:295,ox:32,oy:20,w:64,h:64,rot:0,rRot:0,parent:RIGHTCALF}
RIGHTBICEP = {x:95,y:120,ox:32,oy:20,w:64,h:64,rot:0,rRot:0,parent:BODY}
LEFTBICEP = {x:175,y:120,ox:32,oy:20,w:64,h:64,rot:0,rRot:0,parent:BODY}
RIGHTFOREARM = {x:95,y:155,ox:32,oy:20,w:64,h:64,rot:0,rRot:0,parent:BODY}
LEFTFOREARM = {x:175,y:155,ox:32,oy:20,w:64,h:64,rot:0,rRot:0,parent:BODY}
RIGHTHAND = {x:95,y:190,ox:32,oy:20,w:64,h:64,rot:0,rRot:0,parent:BODY}
LEFTHAND = {x:175,y:190,ox:32,oy:20,w:64,h:64,rot:0,rRot:0,parent:BODY}
  set_relative_coords(HEAD);
  set_relative_coords(LEFTTHIGH);
  set_relative_coords(RIGHTTHIGH);
  set_relative_coords(LEFTCALF);
  set_relative_coords(RIGHTCALF);
  set_relative_coords(LEFTBOOT);
  set_relative_coords(RIGHTBOOT);
  set_relative_coords(RIGHTBICEP);
  set_relative_coords(LEFTBICEP);
  set_relative_coords(RIGHTFOREARM);
  set_relative_coords(LEFTFOREARM);
  set_relative_coords(RIGHTHAND);
  set_relative_coords(LEFTHAND);
  
  
  ////////////////////////////////////////////////////////////////////////
  ////GUI BUTTONS
part={x:600,y:50,w:150,h:75,text:'NONE',tColor:[255,255,255],color:[255,0,255],bColor:[44,44,44]}
  
  
  
}

function draw_button(obj){
  draw_set_color(obj.color[0],obj.color[1],obj.color[2]);
  draw_rectangle(obj.x, obj.y, obj.w, obj.h,false,0,0,0);
  draw_set_color(obj.bColor[0],obj.bColor[1],obj.bColor[2]);
  draw_set_linewidth(8);
  draw_rectangle(obj.x, obj.y, obj.w, obj.h,true,0,0,0);
  draw_set_color(obj.tColor[0],obj.tColor[1],obj.tColor[2]);
  draw_centered_text(obj.x+obj.w/2, obj.y+obj.h/2, obj.text, Math.min(obj.h,obj.w)/2);
}
function loop(){
  parent(HEAD)
  parent(LEFTTHIGH)
  parent(RIGHTTHIGH)
  parent(LEFTCALF)
  parent(RIGHTCALF)
  parent(LEFTBOOT)
  parent(RIGHTBOOT)
  parent(RIGHTBICEP)
  parent(LEFTBICEP)
  parent(RIGHTFOREARM)
  parent(LEFTFOREARM)
  parent(RIGHTHAND)
  parent(LEFTHAND)
  input()
}
function parent(obj){
  if(obj.pDis && obj.pDir){
    obj.x = obj.parent.x+lengthdir_x(obj.pDis, obj.pDir-obj.parent.rot);
    obj.y = obj.parent.y+lengthdir_y(obj.pDis, obj.pDir-obj.parent.rot);
    obj.rot = obj.parent.rot-obj.rRot
    
  }
  
}
function set_relative_coords(obj){
  obj.pDis = Math.round(point_distance(obj.parent.x,obj.parent.y,obj.x,obj.y))
  obj.pDir = Math.round(point_direction(obj.parent.x,obj.parent.y,obj.x,obj.y)+obj.parent.rot)
  obj.rRot =  obj.parent.rot - obj.rot
}
function draw(){
  
  draw_shape(HEAD,sprite_head) 
  draw_shape(BODY,sprite_body)
  draw_shape(LEFTTHIGH,sprite_leg)
  draw_shape(RIGHTTHIGH,sprite_leg)
  draw_shape(LEFTCALF,sprite_leg)
  draw_shape(RIGHTCALF,sprite_leg)
  draw_shape(LEFTBOOT,sprite_boot)
  draw_shape(RIGHTBOOT,sprite_boot)
  draw_shape(RIGHTBICEP,sprite_leg)
  draw_shape(LEFTBICEP,sprite_leg)
  draw_shape(RIGHTFOREARM,sprite_leg)
  draw_shape(LEFTFOREARM,sprite_leg)
  draw_shape(RIGHTHAND,sprite_left_hand)
  draw_shape(LEFTHAND,sprite_right_hand)
  draw_button(part)
  draw_set_color(0,0,0)
  draw_text(0,canvas.height-60, mouse_x+' , '+mouse_y, 60)
}
function part_select(obj){
  let mouse_inside=false
  if(inside(mouse_x, mouse_y, obj.x,obj.y, obj.w, obj.h, obj.rot, obj.ox, obj.oy)){
    mouse_inside = true
  }
  return mouse_inside;
}
function input(){
  
  if(keyboard_check(vk_a)){
    HEAD.rot += wheelDir*6;
    set_relative_coords(HEAD);
  }
  if(keyboard_check(vk_b)){
    BODY.rot += wheelDir*6;
    // set_relative_coords(BODY);
    parent(HEAD);
  }
  
  wheelDir=0
  if(part_select(HEAD)){selected=HEAD};
  if(part_select(BODY)){selected=BODY};
  if(part_select(LEFTTHIGH)){selected=LEFTTHIGH};
  if(part_select(RIGHTTHIGH)){selected=RIGHTTHIGH};
  if(part_select(LEFTCALF)){selected=LEFTCALF};
  if(part_select(RIGHTCALF)){selected=RIGHTCALF};
  if(part_select(LEFTBOOT)){selected=LEFTBOOT};
  if(part_select(RIGHTBOOT)){selected=RIGHTBOOT};
  if(part_select(RIGHTBICEP)){selected=RIGHTBICEP};
  if(part_select(LEFTBICEP)){selected=LEFTBICEP};
  if(part_select(RIGHTFOREARM)){selected=RIGHTFOREARM};
  if(part_select(LEFTFOREARM)){selected=LEFTFOREARM};
  if(part_select(RIGHTHAND)){selected=RIGHTHAND};
  if(part_select(LEFTHAND)){selected=LEFTHAND};
  if(selected){part.text=selected}
}


function draw_shape(obj,img){
  draw_image(img,obj.x-obj.ox,obj.y-obj.oy,obj.w,obj.h,obj.rot,obj.ox,obj.oy)
  draw_set_color(255,0,0)
  draw_circle(obj.x, obj.y, 8, false)
}

</script>
<script type='text/javascript' src='engine.js'></script>

</body>
</html>
