<!DOCTYPE html>
  <html lang="en">
    <head>
    <meta charset="utf-8">
      <title>DungeonTimes</title>
<style>
      body {
        margin: 0;
        padding: 0;
      }
</style>
</head>
<body>
  <script>        
function blank(){}
 var maps = [];
 var mapIndex= 0;
 var map1 = [[40,40,40,40,40,40,40,40,40,40,40,40,40,40],[1,41,98,41,2,3,2,2,2,2,2,2,2,3],[1,0,0,0,0,3,0,0,0,0,0,0,30,3],[1,12,5,12,12,13,0,0,0,12,12,12,12,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,0,0,34,0,0,0,34,0,0,0,0,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,0,0,0,0,0,19,0,0,0,0,0,3],[1,0,0,15,0,0,0,0,0,0,0,0,0,3],[1,0,0,0,0,0,0,0,0,0,0,34,0,3],[1,0,0,0,0,1,12,5,12,3,0,0,0,3],[1,0,0,0,0,1,0,0,0,3,0,0,0,3],[1,0,0,0,0,1,29,0,29,3,0,0,0,3],[11,12,12,12,12,12,12,12,12,12,12,12,12,13],];
maps.push(map1)
var map2 = [[40,40,40,40,40,40,40,40,40,40,40,40,40,40],[1,41,98,41,3,1,2,3,1,2,2,2,2,3],[1,0,0,0,3,1,0,3,1,0,15,15,0,3],[1,12,5,12,12,12,0,3,1,0,0,0,0,3],[1,0,0,0,0,0,0,3,1,0,0,0,0,3],[1,0,1,12,12,12,12,13,11,3,0,0,0,3],[1,34,1,1,12,12,12,12,3,3,0,0,0,3],[1,0,1,1,40,40,40,40,3,3,0,19,0,3],[1,0,1,1,40,40,40,40,3,3,0,0,0,3],[1,34,1,1,40,40,40,40,3,3,0,19,0,3],[1,0,1,11,12,12,12,12,13,3,0,0,0,3],[1,0,11,12,12,12,12,12,12,13,19,0,0,3],[1,0,30,0,0,0,0,0,0,0,0,0,0,3],[11,12,97,12,12,12,12,12,12,12,12,12,12,13],];
maps.push(map2)
var map3 = [[40,40,40,40,40,40,40,40,40,40,40,40,40,40],[1,2,2,2,2,2,2,2,2,76,2,98,76,3],[1,0,0,0,0,0,0,0,0,76,0,0,76,3],[1,0,0,0,0,0,0,0,0,12,12,4,12,3],[1,0,0,31,0,0,0,0,0,0,0,0,0,3],[1,0,0,0,0,0,31,0,0,0,0,0,0,3],[1,0,0,0,34,0,0,0,0,33,0,0,0,3],[1,0,0,0,32,0,0,0,0,0,0,0,0,3],[1,32,0,0,0,0,0,34,0,0,33,0,0,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,0,0,0,0,0,0,0,0,34,0,0,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,0,0,0,0,0,30,0,0,0,0,0,3],[11,12,12,12,12,12,12,97,12,12,12,12,12,13],];
maps.push(map3)
var battleMap = [[40,40,40,40,40,40,40,40,40,40,40,40,40,40],[40,40,40,40,40,40,40,40,40,40,40,40,40,40],[40,40,40,40,40,40,40,40,40,40,40,40,40,40],[40,40,40,40,40,40,40,40,40,40,40,40,40,40],[1,2,2,2,2,2,2,2,2,2,2,2,2,3],[1,36,36,36,36,36,36,36,36,36,36,36,36,3],[1,36,36,36,36,36,36,36,36,36,36,36,36,3],[1,36,36,36,36,36,36,36,36,36,36,36,36,3],[1,36,36,36,36,36,36,36,36,36,36,36,36,3],[11,12,12,12,12,12,12,12,12,12,12,12,12,13],[40,40,40,40,40,40,40,40,40,40,40,40,40,40],[40,40,40,40,40,40,40,40,40,40,40,40,40,40],[40,40,40,40,40,40,40,40,40,40,40,40,40,40],[40,40,40,40,40,40,40,40,40,40,40,40,40,40],];
var mathMap = [[40,40,40,40,40,40,40,40,40,40,40,40,40,40],[1,2,2,2,2,2,2,2,2,2,2,2,2,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,30,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,60,61,62,63,64,65,66,67,68,69,0,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,71,72,71,73,0,0,0,0,0,0,0,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[11,12,12,12,12,12,12,12,12,12,12,12,12,13],[40,40,40,40,40,40,40,40,40,40,40,40,40,40],];



var zoom = 185;

document.body.style.zoom = zoom+"%";
var bgImage = new Image();
bgImage.src = 'DungeonTimesTiles.png';
var jiggleX = -1;
var jiggleY = -1;
var destroyX = -1;
var destroyY = -1;
var level=1
var levelStartPos = []
var levelEndPos = []
function blank(){};
var destID=null
var move=false;
var nmeMoves = []
function wait(what,when){
  setTimeout(function(){what},when)
}
function checkNumTiles(){
 //{num:tile,x:x,y:y};numTiles
  for(i=0;i<numTiles.length;i++){
    if(currentMap[numTiles[i].y][numTiles[i].x] == 0){
      currentMap[numTiles[i].y][numTiles[i].x] = numTiles[i].num
    }
  }
}
function moveNme(tile,x,y){
  let dir = ['left', 'up', 'right', 'down'][Math.floor(Math.random() * 4)];
  if(dir=='left' && currentMap[y][x-1]==0){
    nmeMoves.push({y:y,x:x,ny:y,nx:x-1,tile:tile});
  }
    if(dir=='up' && currentMap[y-1][x]==0){
      nmeMoves.push({y:y,x:x,ny:y-1,nx:x,tile:tile});
  }
    if(dir=='right' && currentMap[y][x+1]==0){
      nmeMoves.push({y:y,x:x,ny:y,nx:x+1,tile:tile});
  }
    if(dir=='down' && currentMap[y+1][x]==0){
      nmeMoves.push({y:y,x:x,ny:y+1,nx:x,tile:tile});
  }
}
function movePlayer(dx, dy) {
  move=true;
  newX = hero.x + dx;
  newY = hero.y + dy;
  // Check for collisions   //40
  if (currentMap[newY][newX] == 0 || currentMap[newY][newX] == 17 || currentMap[newY][newX] == 36 || currentMap[newY][newX]>49 && currentMap[newY][newX]<60 || currentMap[newY][newX] == 97 || currentMap[newY][newX] == 98){
    // if newPos hits empty
    hero.x = newX;
    hero.y = newY;
    if(currentMap[newY][newX] == 98){ // exit door
      levelEndPos[mapIndex]={x:newX-dx,y:newY-dy}
      setTimeout(function(){
        
        mapIndex++;
        if(mapIndex==maps.length){mapIndex=0}
        if(levelStartPos[mapIndex]!=null){
          hero.x=levelStartPos[mapIndex].x;
          hero.y=levelStartPos[mapIndex].y;
        }
        currentMap = maps[mapIndex]

        },1)
    }
        if(currentMap[newY][newX] == 97){ // entrance door
      setTimeout(function(){
        mapIndex--;
        hero.x=levelEndPos[mapIndex].x;
        hero.y=levelEndPos[mapIndex].y;
        currentMap = maps[mapIndex]

        },1)
    }
  }
  if (currentMap[newY][newX] >49 && currentMap[newY][newX] <60){ //floor numbers
    
  }
  if (currentMap[newY][newX] >59 && currentMap[newY][newX] <70){ //push crates
     // newX = hero.x + dx;
     // newY = hero.y + dy;
        if (currentMap[newY + dy][newX + dx] == 71 || currentMap[newY + dy][newX + dx] == 72 || currentMap[newY + dy][newX + dx] == 73 || currentMap[newY + dy][newX + dx] == 0 || currentMap[newY + dy][newX + dx] == 17 || currentMap[newY + dy][newX + dx]>49 && currentMap[newY + dy][newX + dx]<60){
        
        let temp = currentMap[newY][newX];
      	currentMap[newY][newX]=0;
        currentMap[newY + dy][newX + dx] = temp
      }
    checkNumTiles();
  }
  //document.title = newY
  if (currentMap[newY][newX] >=4 && currentMap[newY][newX] <=7) {
    // if newPos hits single door
    if(hero.keys>0){
    currentMap[newY][newX] = 0;
    destroyX=newX;
    destroyY=newY;
    destID = 'door'
    setTimeout(function(){
      destroyX=-1;
      destroyY=-1}
               ,100)
    hero.keys--;
    keyShake = true;
    setTimeout(function(){
      keyShake=false}
               ,1000)
    keyTrend = -1
    }else{
      // this sets up the chest to shake when its tried without a key
      jiggleX = newX;jiggleY = newY;
    }
  }
  if (currentMap[newY][newX] >=14 && currentMap[newY][newX] <=15) {
    if(hero.keys>0){
    // if newPos hits chest
    currentMap[newY][newX] = 0;
    chest(100,newX,newY)
    hero.keys--;
    keyTrend = -1;
    keyShake = true;
    setTimeout(function(){
      keyShake=false}
               ,1000)
    }else{
      // this sets up the chest to shake when its tried without a key
      jiggleX = newX;jiggleY = newY;
    }
    //Opens door by turning door to empty tile
  }

  if (currentMap[newY][newX] == 19 ) {
    // if newPos hits gold key
    currentMap[newY][newX] = 0;
    hero.keys++;
    keyTrend = 1;
    keyShake = true;
    setTimeout(function(){
      keyShake=false}
               ,1000)
    hero.x = newX;
    hero.y = newY;
    //picks up key by turning door to empty tile
    // and adding it to inventory
  }
  if (currentMap[newY][newX] == 29 ) {
    // if newPos hits health potion
    currentMap[newY][newX] = 0;
    if(hero.health<100){
      hero.health+=10};
        healthShake = true;
    setTimeout(function(){
      healthShake=false}
               ,1000)
    healthTrend = 1
    hero.x = newX;
    hero.y = newY;
    //picks up key by turning potion to empty tile
    // and adding it to inventory
  }
  if (currentMap[newY][newX] > 30  && currentMap[newY][newX] < 35) {
    combat(currentMap[newY][newX])
  }
  if(currentMap==mathMap){
    //11,11
    if(hero.x==11 || hero.x==12){
      if(hero.y==11){
      	setTimeout(function(){resetMap('mathMap');currentMap = mathMap;},100);
      }
    }
  }
}
function destroy(id){
 //var destroyX = -1;
//var destroyY = -1; 
  
  if(id=='door'){ctx.fillStyle = "#6e4a48";drawText(destroyX,destroyY,'[][][][]',4,0,10)}
  if(id=='nme'){ctx.fillStyle = "#ff0000";drawText(destroyX,destroyY,'!',0,0,16)}
 }
// Define the size of your tiles.
const tileSize = 16;
var currentMap = maps[mapIndex];
document.title = currentMap
var battle = false;
var nme = 31;
var factorA = 0;
var factorB = 0;
var answer = 0;
var product = 0;
var newX = 0;
var newY = 0;
var gameOver = false;
var setNumber=false;
var nmeX = 12;
var numTiles=[];
var numTilesLoaded=false;
//context.drawImage(img, sx, sy, swidth, sheight, x, y, width, height)
// Game objects
function obj(id, x, y, tile, sw, sh, speed) {
  this.id = id;
  this.frame = 0;
  this.x = x;
  this.y = y;
  this.tile = tile;
  this.sw = sw;
  this.sh = sh;
  this.speed = speed;
  this.woof = function(){
    // only an example if I needed it for later
    alert('ruff ruff '+ this.x);
  }
}
//             obj(id, x, y, img, sx, sy, sw, sh, speed) 
var hero = new obj('hero',2,2,30,16,16,100);
hero.health = 100;
hero.lives = 2;
hero.keys = 0;
hero.coins = 0;
var mystery1 = new obj('',-1,-1,71,16,16,100);
var mystery2 = new obj('',-1,-1,71,16,16,100);
var times = new obj('',-1,-1,72,16,16,100);
var equals = new obj('',-1,-1,73,16,16,100);


//setInterval(function(){hero.frame+=16;if(hero.frame>160){hero.frame=0}}, 200);
// Update game objects
function update() {
   
  if(battle==false){
    if (87 in keysDown || 38 in keysDown) {
      // Player holding up
      //hero.y -= hero.speed * modifier;
      movePlayer(0, -1)
      delete keysDown[87]
      delete keysDown[38]
    }
    if (83 in keysDown || 40 in keysDown) {
      // Player holding down
      //hero.y += hero.speed * modifier;
      movePlayer(0, 1)
      delete keysDown[83]
      delete keysDown[40]
    }
    if (65 in keysDown || 37 in keysDown) {
      // Player holding left
      //hero.x -= hero.speed * modifier;
      movePlayer(-1, 0)
      hero.tile = 42
      delete keysDown[65]
      delete keysDown[37]
    }
    if (68 in keysDown || 39 in keysDown) {
      // Player holding right
      //hero.x += hero.speed * modifier;
      movePlayer(1, 0)
      hero.tile = 30
      delete keysDown[68]
      delete keysDown[39]
    }
    
    
    
    if (82 in keysDown) {resetGame(map2)}
    ///////////////////////////////////////////////////////////////////////////////////////////////
  }
  else{
    if (96 in keysDown ) {
      answer+='0';
      delete keysDown[96]}
    if (97 in keysDown) {
      answer+='1';
      delete keysDown[97]}
    if (98 in keysDown) {
      answer+='2';
      delete keysDown[98]}
    if (99 in keysDown) {
      answer+='3';
      delete keysDown[99]}
    if (100 in keysDown) {
      answer+='4';
      delete keysDown[100]}
    if (101 in keysDown) {
      answer+='5';
      delete keysDown[101]}
    if (102 in keysDown) {
      answer+='6';
      delete keysDown[102]}
    if (103 in keysDown) {
      answer+='7';
      delete keysDown[103]}
    if (104 in keysDown) {
      answer+='8';
      delete keysDown[104]}
    if (105 in keysDown) {
      answer+='9';
      delete keysDown[105]}
    if (13 in keysDown) {
      check();
      answer='';
      delete keysDown[13]}
     if (8 in keysDown) {
      answer='';
      delete keysDown[8]}   
     if (48 in keysDown ) { 
      answer+='0';
      delete keysDown[48]}
    if (49 in keysDown) {
      answer+='1';
      delete keysDown[49]}
    if (50 in keysDown) {
      answer+='2';
      delete keysDown[50]}
    if (51 in keysDown) {
      answer+='3';
      delete keysDown[51]}
    if (52 in keysDown) {
      answer+='4';
      delete keysDown[52]}
    if (53 in keysDown) {
      answer+='5';
      delete keysDown[53]}
    if (54 in keysDown) {
      answer+='6';
      delete keysDown[54]}
    if (55 in keysDown) {
      answer+='7';
      delete keysDown[55]}
    if (56 in keysDown) {
      answer+='8';
      delete keysDown[56]}
    if (57 in keysDown) {
      answer+='9';
      delete keysDown[57]}

  }
};
// Draw everythingHero 
function render() {
  // Clear the canvas  
  ctx.clearRect(0, 0, c.width, c.height);
  // ctx.drawImage(bgImage, 0, 0, c.width, c.height);
  // Score
  // ctx.fillText("mouse x,y: " + mX.toFixed(2) + ' , ' + mY.toFixed(2), 16, 64);
  // ctx.fillText("mDown: " + mDown, 16, 96);
  drawOther();
  drawMap(currentMap);
  if(currentMap==mathMap){drawResetButton(11,11,10,2,1)}
  drawHero();
  drawHud();
  destroy(destID);
  drawBattle();
  if(battle==true){drawKeyboard()}
  
  if(gameOver==true){
    alert('GAME OVER')}
};
function chest(lvl,x,y){
  for(i=0;i<lvl;i++){
    let treasure = Math.floor(Math.random()*2);
    let tx = Math.floor(Math.random()*3)-1;
    let ty = Math.floor(Math.random()*3)-1;
    if(currentMap[y+ty][x+tx]==0){
      currentMap[y+ty][x+tx]=29}
  }
}

function shakeTile(tile,x,y,shake){
  let shakeX = (Math.random()*-shake)+(shake/2);
  let shakeY = (Math.random()*-shake)+(shake/2);
  var row = Math.floor(tile/10)
  var col = tile % 10;
  var sx = col*16
  var sy = row*16
  ctx.drawImage(bgImage, sx+shakeX, sy+shakeY, 16, 16, x*16, y*16, 16, 16);
}
function looper(min, max, step) {
  let current = min;
  let increasing = true;
  return function () {
    if (increasing) {
      current += step;
      if (current >= max) {
        increasing = false;
        current = max;
      }
    }
    else {
      current -= step;
      if (current <= min) {
        increasing = true;
        current = min;
      }
    }
    return current;
  };
}
const bouncer = looper(0, 8, 1);
function drawTile(tile,x,y,modX,modY,scaleX,scaleY){
  if(modX==null){
    modX=0}
  if(modY==null){
    modY=0}
  if(scaleX==null){
    scaleX=100}
  if(scaleY==null){
    scaleY=100}
  var row = Math.floor(tile/10)
  var col = tile % 10;
  var sx = col*16
  var sy = row*16
  ctx.drawImage(bgImage, sx, sy, 16, 16, x*16+modX, y*16+modY, 16*(scaleX/100), 16*(scaleY/100));
}
function drawFloorObj(text,y,x,tSize,modY,modX){
  ctx.beginPath();
  ctx.lineWidth = "1";
  ctx.strokeStyle = "#25131a";
  ctx.fillStyle = "#25131a"
  ctx.rect(x*16+1, y*16+1, 15, 14);
  ctx.stroke();  
  drawText(x,y,text,tSize,modX,modY)
}
function drawGameObj(text,y,x,tSize,modY,modX){
  ctx.fillStyle = "#25131a"
  ctx.fillRect(x*16+1, y*16+1, 15, 14);
  ctx.fillStyle = "#78514f"
  //ctx.fillRect(x*16+1, y*16+1, 15, 4);
  ctx.beginPath();
  ctx.lineWidth = "1";
  ctx.strokeStyle = "#78514f";
  ctx.rect(x*16+1, y*16+1, 15, 14);
  ctx.stroke();
  ctx.fillStyle = "rgb(250, 250, 250)";
  drawText(x,y,text,tSize,modX,modY)
  if(text=='='){drawGameObj(product,equals.x,equals.y+1,10,2,2)}
}
function drawResetButton(x,y,tSize,modX,modY){
  ctx.fillStyle = "#25131a"
  ctx.fillRect(x*16+1, y*16+1, 29, 14);
  ctx.fillStyle = "#78514f"
  //ctx.fillRect(x*16+1, y*16+1, 15, 4);
  ctx.beginPath();
  ctx.lineWidth = "1";
  ctx.strokeStyle = "#78514f";
  ctx.rect(x*16+1, y*16+1, 29, 14);
  ctx.stroke();
  ctx.fillStyle = "rgb(250, 250, 250)";
  drawText(x,y,'reset',tSize,modX,modY)
}
function checkAnswer(){
  
  if(currentMap==mathMap){
  if((currentMap[mystery1.x][mystery1.y]-60)*(currentMap[mystery2.x][mystery2.y]-60)==product) {
    
   setTimeout(function(){alert('Math')},100); 
  }
  }
}
function setAnswer(){
  setNumber=true;
  factorA = Math.floor(Math.random()*9)+1 ;
  factorB = Math.floor(Math.random()*9)+1 ;
  if(factorA==factorB){if(factorA==1){factorA++}else{factorA--}}
  answer = '';
  product = factorA*factorB;
  
}
function drawOther(){
  if(setNumber==false){setAnswer()}else{checkAnswer()}
  drawFloorObj('?',mystery1.x,mystery1.y,12,1,5)
  drawFloorObj('?',mystery2.x,mystery2.y,12,1,5)
  drawGameObj('x',times.x,times.y,12,1,4)
  drawGameObj('=',equals.x,equals.y,12,0,3)
  
}
function drawHero(){
  drawTile(hero.tile,hero.x,hero.y)
}
setInterval(function(){
  if(battle==true){
    nmeX--;
    if(nmeX==1){
      check()}
  }
}
            ,1000)
function combat(enemy){  
  nme = enemy;
  nmeX = 12;
  factorA = Math.floor(Math.random()*(level+2)) ;
  factorB = Math.floor(Math.random()*(level+2)) ;
  answer = '';
  product = factorA*factorB;
  battle=true;
  move=false;
}
function drawBattle(){
  if(battle==true){
    drawMap(battleMap);
    // player 1,8 nme 12,8
    ctx.fillStyle = "rgb(250, 250, 250)"
    drawTile(30,1,8)
    drawTile(nme+12,nmeX,8)
    drawText(0,2,factorA+' X '+factorB+' = '+answer,32)
  }
}
function check(){
  if(answer==product && answer!=''){
    battle=false;
    hero.coins+=level;
    setTimeout(function(){
      currentMap[newY][newX]=17;
    }
               ,300)
  }
  else{
    battle=false;
    healthShake=true;
    healthTrend = -1
    setTimeout(function(){
      healthShake=false}
               ,1000)
    hero.health-=10;
    if(hero.health<0){
      if(hero.lives>0){
        hero.health=100;
        hero.lives--;
      }
      else{
        gameOver=true;
      }
    }
  }
}
function drawText(x,y,text,fsize,modY,modX){
  if(fsize==null){fsize=14}
  if(modX==null){modX=0}
  if(modY==null){modY=0}
  var row = y*16+2+modX;
  var col = x*16+modY;
  //    destroyX=newX;
    destroyY=newY;
    destID = 'door';
  ctx.font = fsize+"px Helvetica";
  ctx.textAlign = "left";
  ctx.textBaseline = "top";
  ctx.fillText(text,col, row);
}
var lifeShake = false;
var lifeTrend = 0;
var healthShake = false;
var healthTrend = 0;
var keyShake = false;
var keyTrend = 0;

function drawHud(){
  ctx.fillStyle = "rgb(250, 250, 250)"
  if(lifeShake==true){
    shakeTile(30,3,0,1);
    if(lifeTrend<0){ctx.fillStyle = "rgb(250, 0, 0)"}
    if(lifeTrend>0){ctx.fillStyle = "rgb(0, 250, 0)"}
  }
  else{
    drawTile(30,3,0)};
  drawText(4,0,':'+hero.lives)
  ctx.fillStyle = "rgb(250, 250, 250)"
  if(healthShake==true){
    shakeTile(28,5,0,1);
    if(healthTrend<0){ctx.fillStyle = "rgb(250, 0, 0)"}
    if(healthTrend>0){ctx.fillStyle = "rgb(0, 250, 0)"}
  }
  else{
    drawTile(28,5,0)};
  drawText(6,0,':'+hero.health)
  ctx.fillStyle = "rgb(250, 250, 250)"
  if(keyShake==true){
    shakeTile(19,8,0,1);
    ctx.fillStyle = "rgb(0, 250, 0)"
    if(keyTrend<0){ctx.fillStyle = "rgb(250, 0, 0)"}
    if(keyTrend>0){ctx.fillStyle = "rgb(0, 250, 0)"}  
  }
  else{
    drawTile(19,8,0)};
  drawText(9,0,':'+hero.keys)
  drawTile(16,10,0);
  ctx.fillStyle = "rgb(250, 250, 250)"
  drawText(11,0,':'+hero.coins)
}
function drawMap(map) {
  for (let y = 0; y < map.length; y++) {
    for (let x = 0; x < map[y].length; x++) {
      var tile = map[y][x];
      if (tile==30){
        // this loads the player start position
        map[y][x] = 0;
        hero.x = x;
        hero.y = y
        levelStartPos.push({x:x,y:y});
      }
      var row = Math.floor(tile/10)
      var col = tile % 10;
      //this keeps from drawing tile0 that I had to add cause piskel doesnt play well with blank tiles
      if(tile!=0){
        if(tile>=31 && tile<=34){
          if(move==true){moveNme(tile,x,y)}
          // this makes bad guys face the hero
          if(hero.x<x){tile+=12} //+12
          // this makes bad guys shake randomly at idle
          let mod = Math.floor(Math.random()*100);
          if(mod==0){
            drawTile(tile,x,y,-1,0);
          }
          if(mod>=1 && mod<=98){
            drawTile(tile,x,y,0,0);
          }
          if(mod==99){
            drawTile(tile,x,y,1,0);
          }
        }
        else{ //jiggleX = newX;jiggleY = newY;
        if(jiggleX==x && jiggleY==y){ // this makes a tile jiggle if its in the appointed map cell
            let modX = Math.floor(Math.random()*2)-1;
            let modY = Math.floor(Math.random()*2)-1;
            drawTile(tile,x,y,modX,modY);
            jiggleX = -1;
            jiggleY = -1;
         }else{
        if(tile>49 && tile<60){ /// floor numbers numTiles[]
          if(numTilesLoaded==false){let temp={num:tile,x:x,y:y};numTiles.push(temp)}
          ctx.beginPath();
		  ctx.lineWidth = "1";
		  ctx.strokeStyle = "#25131a";
          ctx.fillStyle = "#25131a"
          ctx.rect(x*16+1, y*16+1, 15, 14);
          ctx.stroke();  
          drawText(x,y,tile-50,8,6,4)
          //ctx.drawImage(bgImage, col*16, row*16, 16, 16, x*16, y*16, 16, 16)
        }else if(tile>59 && tile<70){  //number crates
          ctx.fillStyle = "#25131a"
          ctx.fillRect(x*16+1, y*16+1, 15, 14);
          ctx.fillStyle = "#78514f"
          //ctx.fillRect(x*16+1, y*16+1, 15, 4);
          ctx.beginPath();
		  ctx.lineWidth = "1";
		  ctx.strokeStyle = "#78514f";
          ctx.rect(x*16+1, y*16+1, 15, 14);
          ctx.stroke();
          ctx.fillStyle = "rgb(250, 250, 250)";
          drawText(x,y,tile-60,10,5,2)

        }else if(tile<50 || tile>69 && tile<71){  // all the rest
        ctx.drawImage(bgImage, col*16, row*16, 16, 16, x*16, y*16, 16, 16)
          /*
          var mystery1 = new obj('',-1,-1,71,16,16,100);
		  var mystery2 = new obj('',-1,-1,71,16,16,100);
		  var times = new obj('',-1,-1,72,16,16,100);
		  var equals = new obj('',-1,-1,73,16,16,100);
           var inDoor = [];
           var outDoor = [];
           var mapIndex= 0;
          */
        }else if(tile==97){ //36
          //map[y][x] = 36;
        ctx.drawImage(bgImage, col*16, row*16, 16, 16, x*16, y*16, 16, 16)             }else if(tile==98){
          //map[y][x] = 36;
        ctx.drawImage(bgImage, col*16, row*16, 16, 16, x*16, y*16, 16, 16)  
       }else if(tile==71){
          if(mystery1.x==-1){mystery1.x=y;mystery1.y=x}else{mystery2.x=y;mystery2.y=x}
          map[y][x] = 0;
        }else if(tile==72){
          times.x = y;
          times.y = x;
          map[y][x] = 0;
        }else if(tile==73){
          equals.x = y;
          equals.y = x;
          map[y][x] = 0;
         }
        }
     
       }   
      
    }
  }
  numTilesLoaded=true;
}
  for(i=0;i<nmeMoves.length;i++){
    //nmeMoves.push({y:y,x:x,ny:y+1,nx:x,tile:tile});
    //map[y][x] = 0
    if(map[nmeMoves[i].ny][nmeMoves[i].nx]==0){
        map[nmeMoves[i].y][nmeMoves[i].x]=0;
    	map[nmeMoves[i].ny][nmeMoves[i].nx] = nmeMoves[i].tile
    }
    if(nmeMoves[i].ny==hero.y && nmeMoves[i].nx==hero.x){
     	combat(currentMap[hero.y][hero.x]) 
    }
  }
  
  nmeMoves = [];
  move=false;
}
// Create the canvas
var c = document.createElement("canvas");
var ctx = c.getContext("2d");
c.width =  224;
c.height = 224;
c.style.position = 'absolute';
c.style.left = 120 + 'px'
c.style.top = 5 + 'px'
c.style.backgroundColor = "#3D253B";
//c.style.display = 'block';
document.body.appendChild(c);
// Handle keyboard controls
var keysDown = {
};
var mDown = false;
var mX = -1;
var mY = -1;
var cLeft = c.offsetLeft*(zoom/100);
var cTop = c.offsetTop*(zoom/100);
addEventListener("keydown",(e)=>{
  keysDown[e.keyCode] = true;
}
                 , false);
addEventListener("keyup",(e)=>{
  delete keysDown[e.keyCode];
}
                 , false);
addEventListener("mousedown",(e)=>{
  mDown=true;
}
                 ,false);
addEventListener("mouseup",(e)=>{
  mDown=false}
                 ,false);
addEventListener("mousemove",(e)=>{
  mX=e.x-cLeft;
  mY=e.y-cTop;
}
                 ,false);
// Reset the game 
var reset = function () {
};
// The main game loop
var main = function () {
  var now = Date.now();
  var delta = now - then;
  update(delta / 1000);
  render();
  then = now;
  // Request to do this again ASAP
  requestAnimationFrame(main);
};
// Cross-browser support for requestAnimationFrame
var w = window;
requestAnimationFrame = w.requestAnimationFrame || w.webkitRequestAnimationFrame || w.msRequestAnimationFrame || w.mozRequestAnimationFrame;
// Let's play this game!
var then = Date.now();
reset();
main();
function resetMap(map){
  if(map=='map1'){
   map1 = [[40,40,40,40,40,40,40,40,40,40,40,40,40,40],[1,41,56,41,2,3,2,2,2,2,2,2,2,3],[1,0,0,0,0,3,0,0,0,0,0,0,30,3],[1,12,5,12,12,13,0,0,0,12,12,12,12,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,0,0,34,0,0,0,34,0,0,0,0,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,0,0,0,0,0,19,0,0,0,0,0,3],[1,0,0,15,0,0,0,0,0,0,0,0,0,3],[1,0,0,0,0,0,0,0,0,0,0,34,0,3],[1,0,0,0,0,1,12,5,12,3,0,0,0,3],[1,0,0,0,0,1,0,0,0,3,0,0,0,3],[1,0,0,0,0,1,29,0,29,3,0,0,0,3],[11,12,12,12,12,12,12,12,12,12,12,12,12,13],];
  }
  if(map=='map2'){
  map2 = [[40,40,40,40,40,40,40,40,40,40,40,40,40,40],[1,41,56,41,3,1,2,3,1,2,2,2,2,3],[1,0,0,0,3,1,0,3,1,0,15,15,0,3],[1,12,5,12,12,12,0,3,1,0,0,0,0,3],[1,0,0,0,0,0,0,3,1,0,0,0,0,3],[1,0,1,12,12,12,12,13,11,3,0,0,0,3],[1,34,1,1,12,12,12,12,3,3,0,0,0,3],[1,0,1,1,40,40,40,40,3,3,0,19,0,3],[1,0,1,1,40,40,40,40,3,3,0,0,0,3],[1,34,1,1,40,40,40,40,3,3,0,19,0,3],[1,0,1,11,12,12,12,12,13,3,0,0,0,3],[1,0,11,12,12,12,12,12,12,13,19,0,0,3],[1,0,30,0,0,0,0,0,0,0,0,0,0,3],[11,12,12,12,12,12,12,12,12,12,12,12,12,13],];
  }
 if(map=='mathMap'){
  mathMap = [[40,40,40,40,40,40,40,40,40,40,40,40,40,40],[1,2,2,2,2,2,2,2,2,2,2,2,2,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,30,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,60,61,62,63,64,65,66,67,68,69,0,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,71,72,71,73,0,0,0,0,0,0,0,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[1,0,0,0,0,0,0,0,0,0,0,0,0,3],[11,12,12,12,12,12,12,12,12,12,12,12,12,13],[40,40,40,40,40,40,40,40,40,40,40,40,40,40],]; 
 }
}
function drawKeyboard(){
  let top = 9.5;
  let left = 4;
  let tall = 24;
  let wide= 32;
  drawButton(left,top,'7',wide,tall);
  if(buttonClick(left,top,wide,tall)){answer+='7'}
  drawButton(left+2,top,'8',wide,tall);
  if(buttonClick(left+2,top,wide,tall)){answer+='8'}
  drawButton(left+4,top,'9',wide,tall);
  if(buttonClick(left+4,top,wide,tall)){answer+='9'}
  drawButton(left,top+1.5,'4',wide,tall);
  if(buttonClick(left,top+1.5,wide,tall)){answer+='4'}
  drawButton(left+2,top+1.5,'5',wide,tall);
  if(buttonClick(left+2,top+1.5,wide,tall)){answer+='5'}
  drawButton(left+4,top+1.5,'6',wide,tall);
  if(buttonClick(left+4,top+1.5,wide,tall)){answer+='6'}
  drawButton(left,top+3,'1',wide,tall);
  if(buttonClick(left,top+3,wide,tall)){answer+='1'}
  drawButton(left+2,top+3,'2',wide,tall);
  if(buttonClick(left+2,top+3,wide,tall)){answer+='2'}
  drawButton(left+4,top+3,'3',wide,tall);
  if(buttonClick(left+4,top+3,wide,tall)){answer+='3'}
  drawButton(left-2,top+3,'0',wide,tall);
  if(buttonClick(left-2,top+3,wide,tall)){answer+='0'}
  drawButton(left+6,top+1.5,'Clear',wide*1.5,tall);
  if(buttonClick(left+6,top+1.5,wide*1.5,tall)){answer=''}
  drawButton(left+6,top+3,'Enter',wide*1.5,tall);
  if(buttonClick(left+6,top+3,wide*1.5,tall)){check()}
  
}
function buttonClick(left,top,wide,tall){
  //document.title = mX
 //mX mY mDown 
  let hit = false;
  let mod = 16*(zoom/100)
 if(mX>left*mod && mX<left*mod+wide*(zoom/100) && mY>top*mod && mY<top*mod+tall*(zoom/100)  && mDown==true){
 	mDown=false;
   hit=true
 }
  return hit	
}
function drawButton(x,y,text,w,h){
  if(w==null){w=16}
  if(h==null){h=16}
  let border = 2
  ctx.fillStyle = "#25131a"
  ctx.fillRect(x*16, y*16, w, h);
  ctx.fillStyle = "#78514f"
  ctx.fillRect(x*16+border, y*16+border, w-border*2, h-border*2);
  ctx.fillStyle = "#ffffff"
  drawText(x,y,text,14,5,4)
}
function resetGame(map){
 resetMap('map1');
 resetMap('map2');
 currentMap = map;
 hero.health = 100;
 hero.lives = 2;
 hero.keys = 0
}
</script>
</body>
</html>
